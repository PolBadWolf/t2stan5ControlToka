
#include "EEPROM.h"
#include "main.h"

/* ------------------------------------------- */
// Прочитать байт из EEPROM
unsigned char ReadEeprom(unsigned int addr)
{
 _WDR();
 while (EECR & 0x02); /* Дождаться готовности */
 EEARL =LOW(addr);
 EEARH =HIGH(addr); /* Используются младшие 256 байт EEPROM */
 EECR |= 0x01; /* Установить бит разрешения чтения */
 return EEDR; /* Прочитать байт */
}

void WriteEeprom(unsigned  int addr,  unsigned char data)
{
 _WDR();
 while(EECR & 0x02); /* ????????? ?????????? */
 EEARL = LOW(addr); /* ???????? ???? ? ??????? ?????? EEPROM */
 EEARH = HIGH(addr); /* ???????????? ??????? 256 ???? EEPROM */
 EEDR = data; /* ???????? ???? ? ??????? ?????? EEPROM */
 _CLI(); /* ????????? ?????????? */
 EECR |= 0x04; /* ?????????? ??? ?????????? ?????? */
 EECR |= 0x02; /* ?????????? ??? ?????? */
 _SEI(); /* ????????? ?????????? */
}
